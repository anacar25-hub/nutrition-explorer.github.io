<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nutritional Database</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      font-family: 'DM Sans', sans-serif;
    }
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: transparent;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 3px;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.3s ease-out forwards;
    }
  </style>
  <script src="https://cdn.tailwindcss.com/3.4.17" type="text/javascript"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0 p-0">
  <div id="app-wrapper" class="h-full w-full overflow-auto" style="background: #faf8f3;"><!-- Navigation Tabs -->
   <div class="sticky top-0 z-40 px-6 md:px-10 pt-6 pb-0" style="border-bottom: 2px solid #e8e5df; background: #faf8f3;">
    <div class="max-w-6xl mx-auto flex items-center justify-between pb-4">
     <div class="flex gap-4"><button id="tab-explorer" onclick="switchToExplorer()" class="px-6 py-3 font-semibold rounded-t-lg transition-all" style="background: white; color: #9ca583; border-top: 3px solid #9ca583;"> ü•ó Food Explorer </button> <button id="tab-goals" onclick="switchToGoals()" class="px-6 py-3 font-semibold rounded-t-lg transition-all" style="background: transparent; color: #7a7970; border-top: 3px solid transparent;"> üéØ Find Foods for a Goal </button>
     </div><button id="dark-mode-toggle" onclick="toggleDarkMode()" class="px-4 py-2 rounded-lg font-semibold transition-all flex items-center gap-2" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;"> <span id="toggle-icon">üåô</span> <span id="toggle-text">Dark</span> </button>
    </div>
   </div><!-- Food Explorer Page -->
   <div id="explorer-page" class="min-h-full w-full p-6 md:p-10">
    <div class="max-w-6xl mx-auto mb-8"><!-- Header -->
     <header class="max-w-6xl mx-auto mb-8">
      <div class="flex items-center gap-4 mb-3">
       <div class="w-14 h-14 rounded-xl flex items-center justify-center" style="background: #9ca583;"><span class="text-6xl">ü•ó</span>
       </div>
       <div>
        <h1 id="app-title" class="text-4xl font-bold" style="color: #2d2d24;">Nutrition Explorer</h1>
        <p id="app-subtitle" class="text-base" style="color: #7a7970;">Discover foods that support your wellness</p>
       </div>
      </div>
     </header><!-- Filter Bar -->
     <div class="max-w-6xl mx-auto mb-8">
      <div class="flex flex-col md:flex-row gap-4 mb-4">
       <div class="flex-1 relative">
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5" style="color: #9ca583;" fill="none" stroke="currentColor" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg><input type="text" id="search-input" placeholder="Search foods..." class="w-full pl-12 pr-4 py-3 rounded-lg text-base focus:outline-none focus:ring-2 transition-all" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;" onfocus="this.style.borderColor='#9ca583'" onblur="updateInputBorder()">
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4"><!-- Category Filter + Add Food Button -->
       <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Category</label>
        <div class="flex gap-2"><select id="category-filter" class="flex-1 px-4 py-3 rounded-lg text-base cursor-pointer focus:outline-none focus:ring-2 transition-all" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;"> <option value="all">All Categories</option> <option value="fruits">üçé Fruits</option> <option value="vegetables">ü•¶ Vegetables</option> <option value="proteins">ü•© Proteins</option> <option value="grains">üåæ Grains</option> <option value="dairy">ü•õ Dairy</option> <option value="nuts">ü•ú Nuts &amp; Seeds</option> <option value="legumes">ü´ò Legumes</option> <option value="oils">ü´í Oils &amp; Condiments</option> </select> <button onclick="openAddFoodModal()" class="px-4 py-3 rounded-lg font-semibold transition-all hover:opacity-90" style="background: #9ca583; color: white; border: none; cursor: pointer; white-space: nowrap;"> + Add Food </button>
        </div>
       </div><!-- Goal Filter -->
       <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Goal</label> <select id="goal-filter" class="w-full px-4 py-3 rounded-lg text-base cursor-pointer focus:outline-none focus:ring-2 transition-all" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;"> <option value="all">All Goals</option> <option value="hormones">‚öñÔ∏è Hormones</option> <option value="gut">ü¶† Gut Health</option> <option value="energy">‚ö° Energy</option> <option value="heart">‚ù§Ô∏è Heart Health</option> <option value="brain">üß† Brain</option> <option value="bone">ü¶¥ Bone</option> <option value="skin">‚ú® Skin</option> </select>
       </div><!-- Nutrient Filter -->
       <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">High In</label> <select id="nutrient-filter" class="w-full px-4 py-3 rounded-lg text-base cursor-pointer focus:outline-none focus:ring-2 transition-all" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;"> <option value="all">All Nutrients</option> <option value="fiber">Fiber</option> <option value="protein">Protein</option> <option value="calcium">Calcium</option> <option value="iron">Iron</option> <option value="vitaminC">Vitamin C</option> <option value="omega3">Omega-3s</option> <option value="antioxidants">Antioxidants</option> <option value="potassium">Potassium</option> </select>
       </div><!-- Body System Filter -->
       <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Body System</label> <select id="system-filter" class="w-full px-4 py-3 rounded-lg text-base cursor-pointer focus:outline-none focus:ring-2 transition-all" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;"> <option value="all">All Systems</option> <option value="gut">ü¶† Gut Health</option> <option value="hormones">‚öñÔ∏è Hormones</option> <option value="energy">‚ö° Energy</option> <option value="heart">‚ù§Ô∏è Heart Health</option> <option value="brain">üß† Brain Health</option> </select>
       </div>
      </div>
     </div><!-- Food Grid -->
     <div id="food-grid" class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"><!-- Foods will be rendered here -->
     </div><!-- Results Count -->
     <div class="max-w-6xl mx-auto mt-8 text-center">
      <p id="results-count" class="text-sm" style="color: #7a7970;"></p>
     </div>
    </div>
   </div><!-- Goals Page -->
   <div id="goals-page" class="hidden min-h-full w-full p-6 md:p-10">
    <div class="max-w-6xl mx-auto"><!-- Goals Header -->
     <header class="mb-8">
      <div class="flex items-center gap-4 mb-3">
       <div class="w-14 h-14 rounded-xl flex items-center justify-center" style="background: #9ca583;"><span class="text-6xl">üéØ</span>
       </div>
       <div>
        <h1 class="text-4xl font-bold" style="color: #2d2d24;">Find Foods for a Goal</h1>
        <p class="text-base" style="color: #7a7970;">Select a health goal and discover foods to support it</p>
       </div>
      </div>
     </header><!-- Goals Selection Grid -->
     <div id="goals-selection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-12"><button onclick="selectGoal('low-energy')" class="p-6 rounded-xl text-left transition-all hover:shadow-lg hover:scale-105 animate-fade-in" style="background: white; border: 2px solid #e8e5df; animation-delay: 0ms;"> <span class="text-4xl mb-3 block">‚ö°</span> <h3 class="font-bold text-lg" style="color: #2d2d24;">Low Energy</h3><p class="text-sm" style="color: #7a7970;">Feeling tired or sluggish</p></button> <button onclick="selectGoal('bloating')" class="p-6 rounded-xl text-left transition-all hover:shadow-lg hover:scale-105 animate-fade-in" style="background: white; border: 2px solid #e8e5df; animation-delay: 30ms;"> <span class="text-4xl mb-3 block">ü¶†</span> <h3 class="font-bold text-lg" style="color: #2d2d24;">Bloating</h3><p class="text-sm" style="color: #7a7970;">Digestive discomfort</p></button> <button onclick="selectGoal('hormone-support')" class="p-6 rounded-xl text-left transition-all hover:shadow-lg hover:scale-105 animate-fade-in" style="background: white; border: 2px solid #e8e5df; animation-delay: 60ms;"> <span class="text-4xl mb-3 block">‚öñÔ∏è</span> <h3 class="font-bold text-lg" style="color: #2d2d24;">Hormone Support</h3><p class="text-sm" style="color: #7a7970;">Balance and regulation</p></button> <button onclick="selectGoal('brain-fog')" class="p-6 rounded-xl text-left transition-all hover:shadow-lg hover:scale-105 animate-fade-in" style="background: white; border: 2px solid #e8e5df; animation-delay: 90ms;"> <span class="text-4xl mb-3 block">üß†</span> <h3 class="font-bold text-lg" style="color: #2d2d24;">Brain Fog</h3><p class="text-sm" style="color: #7a7970;">Clarity and focus</p></button> <button onclick="selectGoal('bone-support')" class="p-6 rounded-xl text-left transition-all hover:shadow-lg hover:scale-105 animate-fade-in" style="background: white; border: 2px solid #e8e5df; animation-delay: 120ms;"> <span class="text-4xl mb-3 block">ü¶¥</span> <h3 class="font-bold text-lg" style="color: #2d2d24;">Bone Support</h3><p class="text-sm" style="color: #7a7970;">Strength and density</p></button> <button onclick="selectGoal('heart-support')" class="p-6 rounded-xl text-left transition-all hover:shadow-lg hover:scale-105 animate-fade-in" style="background: white; border: 2px solid #e8e5df; animation-delay: 150ms;"> <span class="text-4xl mb-3 block">‚ù§Ô∏è</span> <h3 class="font-bold text-lg" style="color: #2d2d24;">Heart Support</h3><p class="text-sm" style="color: #7a7970;">Cardiovascular health</p></button>
     </div><!-- Goal Results (Hidden until goal selected) -->
     <div id="goal-results" class="hidden"><!-- Goal Title -->
      <div class="mb-8 p-6 rounded-xl" style="background: white; border-left: 4px solid #9ca583;">
       <div class="flex items-center gap-3 mb-2"><span id="result-emoji" class="text-5xl"></span>
        <h2 id="result-title" class="text-3xl font-bold" style="color: #2d2d24;"></h2>
       </div>
       <p id="result-description" class="text-base" style="color: #7a7970;"></p>
      </div><!-- Key Nutrients Section -->
      <div class="mb-8">
       <h3 class="font-bold text-xl mb-4" style="color: #2d2d24;">Key Nutrients That Support This Goal</h3>
       <div id="nutrients-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3"></div>
      </div><!-- Recommended Foods Section -->
      <div class="mb-8">
       <h3 class="font-bold text-xl mb-4" style="color: #2d2d24;">8 Recommended Foods</h3>
       <div id="recommended-foods" class="space-y-4"></div>
      </div><!-- Disclaimer -->
      <div class="p-6 rounded-xl" style="background: #faf8f3; border: 2px dashed #e8e5df;">
       <p class="text-xs font-semibold mb-2" style="color: #9ca583;">üìã EDUCATIONAL DISCLAIMER</p>
       <p class="text-sm" style="color: #7a7970;">This information is for educational purposes only and should not replace professional medical advice. Always consult with a healthcare provider before making significant dietary changes, especially if you have existing health conditions or take medications. Individual nutritional needs vary based on age, sex, activity level, and health status.</p>
      </div><!-- Back Button -->
      <div class="mt-8 text-center"><button onclick="backToGoalSelection()" class="px-6 py-3 rounded-lg font-semibold transition-all" style="background: #9ca583; color: white;"> ‚Üê Choose Another Goal </button>
      </div>
     </div>
    </div>
   </div><!-- Detail Modal -->
   <div id="detail-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4" style="background: rgba(0,0,0,0.6);">
    <div class="w-full max-w-2xl max-h-[90%] overflow-auto rounded-2xl" style="background: white; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
     <div id="modal-content"></div>
    </div>
   </div><!-- Add Food Modal -->
   <div id="add-food-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4" style="background: rgba(0,0,0,0.6);">
    <div class="w-full max-w-2xl max-h-[90%] overflow-auto rounded-2xl" style="background: white; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
     <div class="p-8">
      <div class="flex items-center justify-between mb-6">
       <h2 class="text-2xl font-bold" style="color: #2d2d24;">Add New Food</h2><button onclick="closeAddFoodModal()" class="p-2 rounded-lg transition-colors hover:opacity-80" style="background: #f5f5f5;">
        <svg class="w-6 h-6" fill="none" stroke="#2d2d24" stroke-width="2" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg></button>
      </div>
      <div class="mb-6 p-4 rounded-lg" style="background: #faf8f3; border: 1px solid #e8e5df;">
       <p class="text-xs" style="color: #7a7970;">üíæ <strong>Temporary:</strong> This food will be saved in memory only. Refresh the page to reset.</p>
      </div>
      <form id="add-food-form" onsubmit="submitAddFood(event)" class="space-y-6"><!-- Basic Info Section -->
       <div>
        <h3 class="font-bold text-lg mb-4" style="color: #2d2d24;">Basic Information</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Food Name *</label> <input type="text" id="food-name" placeholder="e.g., Apple" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;" required>
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Emoji</label> <input type="text" id="food-emoji" placeholder="üçé" maxlength="2" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Category *</label> <select id="food-category" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;" class="w-full px-4 py-2 rounded-lg" required> <option value="">Select category</option> <option value="fruits">Fruits</option> <option value="vegetables">Vegetables</option> <option value="proteins">Proteins</option> <option value="grains">Grains</option> <option value="dairy">Dairy</option> <option value="nuts">Nuts &amp; Seeds</option> <option value="legumes">Legumes</option> <option value="oils">Oils &amp; Condiments</option> </select>
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Serving Size *</label> <input type="text" id="food-serving" placeholder="e.g., 1 medium (182g)" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;" required>
         </div>
        </div>
       </div><!-- Macronutrients Section -->
       <div>
        <h3 class="font-bold text-lg mb-4" style="color: #2d2d24;">Macronutrients</h3>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Calories *</label> <input type="number" id="food-calories" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;" required>
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Protein (g)</label> <input type="number" id="food-protein" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Carbs (g)</label> <input type="number" id="food-carbs" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Fat (g)</label> <input type="number" id="food-fat" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Fiber (g)</label> <input type="number" id="food-fiber" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Sugar (g)</label> <input type="number" id="food-sugar" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
        </div>
       </div><!-- Micronutrients Section -->
       <div>
        <h3 class="font-bold text-lg mb-4" style="color: #2d2d24;">Micronutrients</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Vitamin C (mg)</label> <input type="number" id="food-vitaminC" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Potassium (mg)</label> <input type="number" id="food-potassium" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Vitamin A (¬µg)</label> <input type="number" id="food-vitaminA" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Iron (mg)</label> <input type="number" id="food-iron" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Calcium (mg)</label> <input type="number" id="food-calcium" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Magnesium (mg)</label> <input type="number" id="food-magnesium" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Zinc (mg)</label> <input type="number" id="food-zinc" placeholder="0" step="0.1" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
        </div>
       </div><!-- Tags Section -->
       <div>
        <h3 class="font-bold text-lg mb-4" style="color: #2d2d24;">Tags &amp; Details</h3>
        <div class="space-y-4">
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Supports (comma-separated)</label> <input type="text" id="food-tags" placeholder="e.g., energy, brain, heart" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Health Benefits (comma-separated)</label> <input type="text" id="food-benefits" placeholder="e.g., Boosts energy, Supports heart health" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
         <div><label class="block text-sm font-semibold mb-2" style="color: #2d2d24;">Pairing Tips (comma-separated)</label> <input type="text" id="food-pairingTips" placeholder="e.g., Pair with nuts for sustained energy" class="w-full px-4 py-2 rounded-lg" style="background: white; color: #2d2d24; border: 2px solid #e8e5df;">
         </div>
        </div>
       </div><!-- Form Actions -->
       <div class="flex gap-3 pt-4"><button type="submit" class="flex-1 px-6 py-3 rounded-lg font-semibold transition-all hover:opacity-90" style="background: #9ca583; color: white; border: none; cursor: pointer;"> Add Food </button> <button type="button" onclick="closeAddFoodModal()" class="flex-1 px-6 py-3 rounded-lg font-semibold transition-all" style="background: #f5f5f5; color: #2d2d24; border: 2px solid #e8e5df; cursor: pointer;"> Cancel </button>
       </div>
       <div id="form-error" class="p-4 rounded-lg" style="background: #fee2e2; color: #991b1b; border: 2px solid #fca5a5; display: none;">
        <p id="error-message" class="font-semibold"></p>
       </div>
      </form>
     </div>
    </div>
   </div>
  </div>
  <script>
    // Theme configuration - SINGLE SOURCE OF TRUTH
    const themes = {
      light: {
        wrapper: '#faf8f3',
        navBar: '#faf8f3',
        surface: '#ffffff',
        text: '#2d2d24',
        textSecondary: '#7a7970',
        border: '#e8e5df',
        input: '#ffffff',
        inputText: '#2d2d24',
        modalBg: '#ffffff'
      },
      dark: {
        wrapper: '#0f172a',
        navBar: '#0f172a',
        surface: '#1e293b',
        text: '#f8fafc',
        textSecondary: '#cbd5e1',
        border: '#334155',
        input: '#1e293b',
        inputText: '#f8fafc',
        modalBg: '#1e293b'
      }
    };

    let isDark = localStorage.getItem('darkMode') === 'true';
    let currentTheme = isDark ? themes.dark : themes.light;

    function getTheme() {
      return currentTheme;
    }

    function updateInputBorder() {
      const input = document.getElementById('search-input');
      input.style.borderColor = getTheme().border;
    }

    function toggleDarkMode() {
      isDark = !isDark;
      currentTheme = isDark ? themes.dark : themes.light;
      localStorage.setItem('darkMode', isDark);
      applyTheme();
    }

    function applyTheme() {
      const theme = getTheme();
      
      // Update toggle button
      const toggleBtn = document.getElementById('dark-mode-toggle');
      const toggleIcon = document.getElementById('toggle-icon');
      const toggleText = document.getElementById('toggle-text');
      
      if (isDark) {
        toggleIcon.textContent = '‚òÄÔ∏è';
        toggleText.textContent = 'Light';
      } else {
        toggleIcon.textContent = 'üåô';
        toggleText.textContent = 'Dark';
      }
      
      // App wrapper background
      const appWrapper = document.getElementById('app-wrapper');
      appWrapper.style.background = theme.wrapper;
      
      // Navigation bar background and toggle button
      const navBar = document.querySelector('.sticky');
      navBar.style.background = theme.navBar;
      navBar.style.borderBottomColor = theme.border;
      toggleBtn.style.background = theme.surface;
      toggleBtn.style.color = theme.text;
      toggleBtn.style.borderColor = theme.border;
      
      // Tab buttons - update based on active state
      const tabExplorer = document.getElementById('tab-explorer');
      const tabGoals = document.getElementById('tab-goals');
      if (!document.getElementById('explorer-page').classList.contains('hidden')) {
        tabExplorer.style.background = theme.surface;
        tabExplorer.style.color = '#9ca583';
        tabExplorer.style.borderTopColor = '#9ca583';
        tabGoals.style.background = 'transparent';
        tabGoals.style.color = theme.textSecondary;
        tabGoals.style.borderTopColor = 'transparent';
      } else {
        tabGoals.style.background = theme.surface;
        tabGoals.style.color = '#9ca583';
        tabGoals.style.borderTopColor = '#9ca583';
        tabExplorer.style.background = 'transparent';
        tabExplorer.style.color = theme.textSecondary;
        tabExplorer.style.borderTopColor = 'transparent';
      }
      
      // Update all direct text colors
      document.getElementById('app-title').style.color = theme.text;
      document.getElementById('app-subtitle').style.color = theme.textSecondary;
      
      // Update all labels
      document.querySelectorAll('label').forEach(label => {
        label.style.color = theme.text;
      });
      
      // Update all headings
      document.querySelectorAll('h1, h2, h3, h4').forEach(h => {
        h.style.color = theme.text;
      });
      
      // Results count
      const resultsCount = document.getElementById('results-count');
      if (resultsCount) resultsCount.style.color = theme.textSecondary;
      
      // Input fields and selects - update ALL
      document.querySelectorAll('input, select').forEach(input => {
        input.style.background = theme.input;
        input.style.color = theme.inputText;
        input.style.borderColor = theme.border;
      });
      
      // Modal background
      const modal = document.getElementById('detail-modal');
      const modalWrapper = modal.querySelector('div:not(#modal-content)');
      if (modalWrapper) {
        modalWrapper.style.background = theme.modalBg;
      }

      const addFoodModal = document.getElementById('add-food-modal');
      const addFoodModalWrapper = addFoodModal.querySelector('div:not(#add-food-form)');
      if (addFoodModalWrapper && addFoodModalWrapper.parentElement === addFoodModal) {
        addFoodModal.querySelector('div > div').style.background = theme.modalBg;
      }
      
      // Re-render grid and goals to update colors
      renderFoodGrid();
      updateGoalsPageTheme();
    }

    function updateGoalsPageTheme() {
      const theme = getTheme();
      
      // Goals selection buttons
      document.querySelectorAll('#goals-selection button').forEach(btn => {
        btn.style.background = theme.surface;
        btn.style.borderColor = theme.border;
        const h3 = btn.querySelector('h3');
        const p = btn.querySelector('p');
        if (h3) h3.style.color = theme.text;
        if (p) p.style.color = theme.textSecondary;
      });
      
      // Goal results section
      const goalResultsBox = document.querySelector('#goal-results > div:nth-child(1)');
      if (goalResultsBox) {
        goalResultsBox.style.background = theme.surface;
        goalResultsBox.style.borderLeftColor = '#9ca583';
        const resultTitle = goalResultsBox.querySelector('h2');
        const resultDesc = goalResultsBox.querySelector('p');
        if (resultTitle) resultTitle.style.color = theme.text;
        if (resultDesc) resultDesc.style.color = theme.textSecondary;
      }
      
      // Nutrient boxes
      document.querySelectorAll('#nutrients-list > div').forEach(nutrient => {
        nutrient.style.background = theme.surface;
        nutrient.style.borderColor = theme.border;
        const p = nutrient.querySelector('p');
        if (p) p.style.color = theme.textSecondary;
      });
      
      // Recommended foods boxes
      document.querySelectorAll('#recommended-foods > div').forEach(food => {
        food.style.background = theme.surface;
        food.style.borderColor = theme.border;
        const h4 = food.querySelector('h4');
        const p = food.querySelector('p');
        if (h4) h4.style.color = theme.text;
        if (p) {
          const texts = food.querySelectorAll('p');
          texts[0].style.color = theme.textSecondary;
          if (texts[1]) texts[1].style.color = '#9ca583';
        }
      });
      
      // Disclaimer
      const disclaimer = document.querySelector('#goal-results > div:nth-last-child(2)');
      if (disclaimer) {
        disclaimer.style.background = theme.wrapper;
        disclaimer.style.borderColor = theme.border;
        const title = disclaimer.querySelector('p:first-child');
        const desc = disclaimer.querySelector('p:last-child');
        if (title) title.style.color = '#9ca583';
        if (desc) desc.style.color = theme.textSecondary;
      }
    }

    // Goal tag mappings for UI display
    const goalIcons = {
      'hormones': '‚öñÔ∏è',
      'gut': 'ü¶†',
      'energy': '‚ö°',
      'heart': '‚ù§Ô∏è',
      'brain': 'üß†',
      'bone': 'ü¶¥',
      'skin': '‚ú®'
    };

    const goalLabels = {
      'hormones': 'Hormones',
      'gut': 'Gut Health',
      'energy': 'Energy',
      'heart': 'Heart',
      'brain': 'Brain',
      'bone': 'Bone',
      'skin': 'Skin'
    };

    // Goal-specific data
    const goalsData = {
      'low-energy': {
        emoji: '‚ö°',
        title: 'Low Energy',
        description: 'Combat fatigue and boost your vitality with nutrient-dense foods rich in B vitamins, iron, and sustained carbohydrates.',
        nutrients: [
          'Iron - Carries oxygen to cells for energy production',
          'B Vitamins - Convert food into usable energy',
          'Complex Carbs - Provide sustained glucose release',
          'Magnesium - Essential for ATP energy synthesis',
          'Protein - Stabilizes blood sugar and energy levels'
        ],
        tags: ['energy']
      },
      'bloating': {
        emoji: 'ü¶†',
        title: 'Bloating',
        description: 'Support digestive comfort with probiotic-rich foods, high-fiber options, and gut-soothing nutrients.',
        nutrients: [
          'Fiber - Feeds beneficial gut bacteria and aids digestion',
          'Probiotics - Support healthy gut microbiome balance',
          'Ginger - Natural digestive enzyme and anti-inflammatory',
          'Magnesium - Promotes smooth muscle relaxation',
          'Enzymes - Help break down food efficiently'
        ],
        tags: ['gut']
      },
      'hormone-support': {
        emoji: '‚öñÔ∏è',
        title: 'Hormone Support',
        description: 'Nourish your endocrine system with foods containing phytoestrogens, healthy fats, and hormone-regulating minerals.',
        nutrients: [
          'Phytoestrogens - Plant compounds that mimic estrogen',
          'Healthy Fats - Essential for hormone production',
          'Zinc - Crucial for reproductive hormone balance',
          'Selenium - Supports thyroid hormone metabolism',
          'Iodine - Regulates thyroid function'
        ],
        tags: ['hormones']
      },
      'brain-fog': {
        emoji: 'üß†',
        title: 'Brain Fog',
        description: 'Enhance mental clarity with omega-3s, antioxidants, and nutrients that support cognitive function and blood flow.',
        nutrients: [
          'Omega-3 Fatty Acids - Build brain cell membranes and reduce inflammation',
          'Antioxidants - Protect brain cells from oxidative damage',
          'Choline - Supports neurotransmitter production for memory',
          'B Vitamins - Essential for brain energy and focus',
          'Polyphenols - Enhance blood flow to the brain'
        ],
        tags: ['brain']
      },
      'bone-support': {
        emoji: 'ü¶¥',
        title: 'Bone Support',
        description: 'Strengthen your skeletal system with calcium, vitamin K, magnesium, and nutrients that support bone density.',
        nutrients: [
          'Calcium - Primary mineral for bone structure and strength',
          'Vitamin K - Activates proteins that bind calcium to bone',
          'Magnesium - Works with calcium for bone mineralization',
          'Vitamin D - Enhances calcium absorption in the intestines',
          'Phosphorus - Works alongside calcium for bone density'
        ],
        tags: ['bone']
      },
      'heart-support': {
        emoji: '‚ù§Ô∏è',
        title: 'Heart Support',
        description: 'Protect cardiovascular health with omega-3s, potassium, fiber, and heart-healthy antioxidants.',
        nutrients: [
          'Omega-3 Fatty Acids - Reduce inflammation and support heart rhythm',
          'Potassium - Regulates blood pressure and heart function',
          'Soluble Fiber - Helps lower cholesterol levels',
          'Polyphenols - Antioxidants that protect heart tissue',
          'Nitrates - Improve blood vessel flexibility and blood flow'
        ],
        tags: ['heart']
      }
    };

    // Comprehensive database with tags
    const foodDatabase = [
      { id: 1, name: 'Apple', emoji: 'üçé', category: 'fruits', tags: ['gut', 'heart', 'energy'], serving: '1 medium (182g)', calories: 95, protein: 0.5, carbs: 25, fat: 0.3, fiber: 4.4, sugar: 19, vitaminC: 14, potassium: 195, vitaminA: 5, iron: 0.2, calcium: 11, magnesium: 9, zinc: 0.1, benefits: ['Supports digestive health', 'Helps manage cholesterol', 'Promotes stable blood sugar'], pairingTips: ['Eat with skin for maximum fiber', 'Pair with nuts for sustained energy'] },
      { id: 2, name: 'Banana', emoji: 'üçå', category: 'fruits', tags: ['heart', 'energy', 'hormones'], serving: '1 medium (118g)', calories: 105, protein: 1.3, carbs: 27, fat: 0.4, fiber: 3.1, sugar: 14, vitaminC: 17, potassium: 422, vitaminA: 3, iron: 0.3, calcium: 6, magnesium: 34, zinc: 0.2, benefits: ['Supports heart function', 'Boosts energy naturally', 'Aids muscle recovery'], pairingTips: ['Eat slightly green for more resistant starch', 'Combine with protein for post-workout recovery'] },
      { id: 3, name: 'Orange', emoji: 'üçä', category: 'fruits', tags: ['brain', 'skin', 'energy'], serving: '1 medium (131g)', calories: 62, protein: 1.2, carbs: 15, fat: 0.2, fiber: 3.1, sugar: 12, vitaminC: 70, potassium: 237, vitaminA: 11, iron: 0.1, calcium: 52, magnesium: 13, zinc: 0.1, benefits: ['Strengthens immune system', 'Supports collagen production', 'Protects against oxidative stress'], pairingTips: ['Eat whole fruit rather than juice to retain fiber', 'Vitamin C enhances iron absorption from other foods'] },
      { id: 4, name: 'Blueberries', emoji: 'ü´ê', category: 'fruits', tags: ['brain', 'skin', 'heart'], serving: '1 cup (148g)', calories: 84, protein: 1.1, carbs: 21, fat: 0.5, fiber: 3.6, sugar: 15, vitaminC: 24, potassium: 114, vitaminA: 3, iron: 0.3, calcium: 9, magnesium: 9, zinc: 0.3, benefits: ['Enhances memory and focus', 'Protects brain cells', 'Reduces inflammation'], pairingTips: ['Frozen blueberries retain anthocyanins', 'Consume regularly for cumulative benefits'] },
      { id: 5, name: 'Strawberries', emoji: 'üçì', category: 'fruits', tags: ['heart', 'skin', 'energy'], serving: '1 cup (144g)', calories: 46, protein: 1, carbs: 11, fat: 0.4, fiber: 3, sugar: 7, vitaminC: 89, potassium: 220, vitaminA: 1, iron: 0.4, calcium: 24, magnesium: 13, zinc: 0.2, benefits: ['Supports cardiovascular health', 'Reduces inflammation', 'Boosts immune function'], pairingTips: ['Fresh preserves more vitamin C than cooked', 'Pair with yogurt for probiotics'] },
      { id: 6, name: 'Avocado', emoji: 'ü•ë', category: 'fruits', tags: ['heart', 'hormones', 'brain'], serving: '1 medium (201g)', calories: 322, protein: 4, carbs: 17, fat: 29, fiber: 13, sugar: 1.3, vitaminC: 20, potassium: 975, vitaminA: 7, iron: 0.6, calcium: 19, magnesium: 43, zinc: 1.3, benefits: ['Supports heart health', 'Aids nutrient absorption', 'Promotes satiety'], pairingTips: ['Fat content aids absorption of fat-soluble vitamins', 'Pair with tomatoes for synergistic benefits'] },
      { id: 7, name: 'Mango', emoji: 'ü•≠', category: 'fruits', tags: ['gut', 'energy', 'skin'], serving: '1 cup (165g)', calories: 99, protein: 1.4, carbs: 25, fat: 0.6, fiber: 2.6, sugar: 23, vitaminC: 60, potassium: 277, vitaminA: 54, iron: 0.3, calcium: 11, magnesium: 18, zinc: 0.1, benefits: ['Aids digestion with enzymes', 'Boosts immunity', 'Provides sustained energy'], pairingTips: ['Enzyme content aids protein breakdown', 'Pair with spicy foods to balance heat'] },
      { id: 8, name: 'Kiwi', emoji: 'ü•ù', category: 'fruits', tags: ['gut', 'brain', 'skin'], serving: '2 medium (152g)', calories: 92, protein: 1.7, carbs: 20, fat: 0.6, fiber: 3.8, sugar: 12, vitaminC: 198, potassium: 312, vitaminA: 4, iron: 0.5, calcium: 61, magnesium: 17, zinc: 0.2, benefits: ['Supports digestive enzymes', 'May improve sleep quality', 'Aids serotonin production'], pairingTips: ['Enzyme aids protein breakdown‚Äîgreat after meals', 'May help with sleep due to serotonin precursors'] },
      { id: 9, name: 'Pineapple', emoji: 'üçç', category: 'fruits', tags: ['gut', 'energy', 'bone'], serving: '1 cup (155g)', calories: 82, protein: 0.9, carbs: 22, fat: 0.2, fiber: 2.7, sugar: 17, vitaminC: 131, potassium: 180, vitaminA: 1, iron: 0.3, calcium: 22, magnesium: 20, zinc: 0.2, benefits: ['Supports protein digestion', 'Reduces inflammation', 'Aids tissue recovery'], pairingTips: ['Fresh pineapple contains bromelain; cooked loses enzyme', 'Combine with collagen sources'] },
      { id: 10, name: 'Broccoli', emoji: 'ü•¶', category: 'vegetables', tags: ['brain', 'gut', 'bone'], serving: '1 cup (91g)', calories: 31, protein: 2.5, carbs: 6, fat: 0.3, fiber: 2.4, sugar: 1.5, vitaminC: 81, potassium: 288, vitaminA: 12, iron: 0.7, calcium: 47, magnesium: 19, zinc: 0.4, benefits: ['Supports detoxification', 'Reduces inflammation', 'Strengthens bones'], pairingTips: ['Steam lightly to preserve sulforaphane', 'Chop and let sit 5 minutes before cooking'] },
      { id: 11, name: 'Spinach', emoji: 'ü•¨', category: 'vegetables', tags: ['brain', 'energy', 'bone'], serving: '1 cup raw (30g)', calories: 7, protein: 0.9, carbs: 1.1, fat: 0.1, fiber: 0.7, sugar: 0.1, vitaminC: 8, potassium: 167, vitaminA: 34, iron: 0.8, calcium: 30, magnesium: 24, zinc: 0.2, benefits: ['Supports eye and brain health', 'Promotes vascular function', 'Aids oxygen transport'], pairingTips: ['Raw preserves folate; cook to reduce oxalates', 'Pair with vitamin C foods to enhance iron absorption'] },
      { id: 12, name: 'Kale', emoji: 'ü•¨', category: 'vegetables', tags: ['brain', 'gut', 'bone'], serving: '1 cup (67g)', calories: 33, protein: 2.2, carbs: 6, fat: 0.6, fiber: 1.3, sugar: 0.9, vitaminC: 80, potassium: 299, vitaminA: 133, iron: 1.1, calcium: 90, magnesium: 23, zinc: 0.3, benefits: ['Supports detoxification pathways', 'Strengthens bone health', 'Boosts immune function'], pairingTips: ['Massage kale to soften for raw consumption', 'Vitamin K helps calcium absorption'] },
      { id: 13, name: 'Bell Pepper', emoji: 'ü´ë', category: 'vegetables', tags: ['heart', 'skin', 'energy'], serving: '1 medium (119g)', calories: 31, protein: 1, carbs: 6, fat: 0.3, fiber: 2.1, sugar: 4.2, vitaminC: 152, potassium: 251, vitaminA: 31, iron: 0.4, calcium: 12, magnesium: 12, zinc: 0.2, benefits: ['Strengthens immune system', 'Supports vascular health', 'Reduces inflammation'], pairingTips: ['Raw peppers have more vitamin C than cooked', 'Red peppers are more nutrient-dense than green'] },
      { id: 14, name: 'Carrots', emoji: 'ü•ï', category: 'vegetables', tags: ['brain', 'skin', 'energy'], serving: '1 medium (61g)', calories: 25, protein: 0.6, carbs: 6, fat: 0.1, fiber: 1.7, sugar: 2.9, vitaminC: 4, potassium: 195, vitaminA: 184, iron: 0.2, calcium: 20, magnesium: 7, zinc: 0.1, benefits: ['Supports eye health and vision', 'Protects skin health', 'Boosts immune function'], pairingTips: ['Cook lightly to enhance beta-carotene bioavailability', 'Combine with fat source for better absorption'] },
      { id: 15, name: 'Sweet Potato', emoji: 'üç†', category: 'vegetables', tags: ['gut', 'energy', 'skin'], serving: '1 medium (114g)', calories: 103, protein: 2.3, carbs: 24, fat: 0.1, fiber: 3.8, sugar: 7, vitaminC: 22, potassium: 438, vitaminA: 142, iron: 0.5, calcium: 56, magnesium: 29, zinc: 0.3, benefits: ['Stabilizes blood sugar', 'Supports gut microbiome', 'Provides sustained energy'], pairingTips: ['Cook and cool to increase resistant starch', 'Eat skin for maximum fiber and nutrients'] },
      { id: 16, name: 'Tomato', emoji: 'üçÖ', category: 'vegetables', tags: ['heart', 'skin', 'energy'], serving: '1 medium (123g)', calories: 22, protein: 1.1, carbs: 4.8, fat: 0.2, fiber: 1.5, sugar: 3.2, vitaminC: 17, potassium: 292, vitaminA: 20, iron: 0.3, calcium: 12, magnesium: 11, zinc: 0.2, benefits: ['Supports cardiovascular health', 'Reduces inflammation', 'Protects bone health'], pairingTips: ['Cooked tomatoes have more bioavailable lycopene', 'Pair with fat to enhance lycopene absorption'] },
      { id: 17, name: 'Garlic', emoji: 'üßÑ', category: 'vegetables', tags: ['heart', 'gut', 'energy'], serving: '3 cloves (9g)', calories: 13, protein: 0.6, carbs: 3, fat: 0, fiber: 0.2, sugar: 0, vitaminC: 3, potassium: 59, vitaminA: 0, iron: 0.2, calcium: 16, magnesium: 2, zinc: 0.1, benefits: ['Supports immune response', 'Promotes heart health', 'Has antimicrobial properties'], pairingTips: ['Chop and let sit 10 minutes to activate compounds', 'Raw has more potent compounds than cooked'] },
      { id: 18, name: 'Cucumber', emoji: 'ü•í', category: 'vegetables', tags: ['gut', 'skin', 'energy'], serving: '1 cup (104g)', calories: 16, protein: 0.8, carbs: 3.6, fat: 0.1, fiber: 0.5, sugar: 1.7, vitaminC: 3, potassium: 142, vitaminA: 5, iron: 0.3, calcium: 16, magnesium: 13, zinc: 0.2, benefits: ['Promotes hydration and electrolyte balance', 'Supports connective tissue health', 'Aids gut bacteria diversity'], pairingTips: ['Eat skin for silica content and fiber', 'Pair with fermented foods for gut synergy'] },
      { id: 19, name: 'Salmon', emoji: 'üêü', category: 'proteins', tags: ['brain', 'heart', 'skin'], serving: '100g cooked', calories: 208, protein: 20, carbs: 0, fat: 13, fiber: 0, sugar: 0, vitaminC: 0, potassium: 363, vitaminA: 45, iron: 0.8, calcium: 12, magnesium: 27, zinc: 0.8, benefits: ['Supports brain and heart health', 'Reduces inflammation significantly', 'Aids cognitive function'], pairingTips: ['Wild salmon has higher omega-3s and lower mercury', 'Pair with antioxidant-rich vegetables'] },
      { id: 20, name: 'Chicken Breast', emoji: 'üçó', category: 'proteins', tags: ['energy', 'brain', 'hormones'], serving: '100g cooked', calories: 165, protein: 31, carbs: 0, fat: 3.6, fiber: 0, sugar: 0, vitaminC: 0, potassium: 256, vitaminA: 0, iron: 1.3, calcium: 15, magnesium: 29, zinc: 1, benefits: ['Supports muscle building', 'Boosts metabolism', 'Aids post-workout recovery'], pairingTips: ['Pair with vegetables to add fiber', 'Cook gently to preserve amino acids'] },
      { id: 21, name: 'Eggs', emoji: 'ü•ö', category: 'proteins', tags: ['brain', 'hormones', 'bone'], serving: '1 large (50g)', calories: 72, protein: 6.3, carbs: 0.4, fat: 5, fiber: 0, sugar: 0.2, vitaminC: 0, potassium: 69, vitaminA: 32, iron: 1.2, calcium: 28, magnesium: 5, zinc: 0.6, benefits: ['Supports brain development', 'Promotes eye health', 'Aids cell membrane integrity'], pairingTips: ['Consume yolk and white together', 'Cook gently to preserve choline'] },
      { id: 22, name: 'Beef (Lean)', emoji: 'ü•©', category: 'proteins', tags: ['energy', 'brain', 'bone'], serving: '100g cooked', calories: 250, protein: 26, carbs: 0, fat: 15, fiber: 0, sugar: 0, vitaminC: 0, potassium: 318, vitaminA: 0, iron: 3.6, calcium: 24, magnesium: 24, zinc: 6, benefits: ['Boosts energy production', 'Supports immune function', 'Builds muscle and strength'], pairingTips: ['Pair with vitamin C foods to enhance iron absorption', 'Balance with other protein sources'] },
      { id: 23, name: 'Tofu', emoji: 'üßà', category: 'proteins', tags: ['hormones', 'energy', 'bone'], serving: '100g', calories: 76, protein: 8, carbs: 1.9, fat: 4.8, fiber: 0.3, sugar: 0.6, vitaminC: 0, potassium: 121, vitaminA: 0, iron: 5.4, calcium: 277, magnesium: 37, zinc: 1.5, benefits: ['Plant-based protein source', 'Supports bone health', 'Aids hormone balance'], pairingTips: ['Press tofu to remove water before cooking', 'Marinate to absorb flavors'] },
      { id: 24, name: 'Lentils', emoji: 'üç≤', category: 'legumes', tags: ['gut', 'energy', 'heart'], serving: '1 cup cooked (198g)', calories: 230, protein: 18, carbs: 40, fat: 0.8, fiber: 15.6, sugar: 2, vitaminC: 2, potassium: 731, vitaminA: 2, iron: 6.6, calcium: 38, magnesium: 71, zinc: 2.5, benefits: ['Stabilizes blood sugar naturally', 'Supports gut microbiome', 'Boosts energy levels'], pairingTips: ['Pair with vitamin C to enhance iron absorption', 'Combine with grains for complete amino acids'] },
      { id: 25, name: 'Chickpeas', emoji: '‚≠ê', category: 'legumes', tags: ['gut', 'hormones', 'energy'], serving: '1 cup cooked (269g)', calories: 269, protein: 15, carbs: 45, fat: 4.3, fiber: 12, sugar: 8, vitaminC: 2, potassium: 477, vitaminA: 2, iron: 4.7, calcium: 80, magnesium: 78, zinc: 2.4, benefits: ['Supports stable blood sugar', 'Aids microbiome health', 'Provides plant-based protein'], pairingTips: ['Cool cooked chickpeas to increase resistant starch', 'Soak before cooking to reduce preparation time'] },
      { id: 26, name: 'Brown Rice', emoji: 'üçö', category: 'grains', tags: ['energy', 'brain', 'gut'], serving: '1 cup cooked (195g)', calories: 216, protein: 5, carbs: 45, fat: 1.8, fiber: 3.5, sugar: 0.7, vitaminC: 0, potassium: 84, vitaminA: 0, iron: 0.8, calcium: 20, magnesium: 84, zinc: 1.2, benefits: ['Stabilizes blood sugar naturally', 'Supports nervous system health', 'Provides sustained energy'], pairingTips: ['Combine with legumes for complete protein', 'Cook with slightly more water for softer texture'] },
      { id: 27, name: 'Quinoa', emoji: 'üåæ', category: 'grains', tags: ['energy', 'bone', 'brain'], serving: '1 cup cooked (185g)', calories: 222, protein: 8.1, carbs: 39, fat: 3.6, fiber: 5.2, sugar: 1.6, vitaminC: 0, potassium: 318, vitaminA: 0, iron: 2.8, calcium: 31, magnesium: 118, zinc: 2, benefits: ['Complete amino acid profile', 'Supports enzyme function', 'Strengthens bones'], pairingTips: ['Rinse before cooking to remove bitter saponins', 'Fluff with fork after cooking'] },
      { id: 28, name: 'Oatmeal', emoji: 'ü•£', category: 'grains', tags: ['gut', 'heart', 'energy'], serving: '1 cup cooked (234g)', calories: 158, protein: 6, carbs: 27, fat: 3.2, fiber: 4, sugar: 1.1, vitaminC: 0, potassium: 164, vitaminA: 0, iron: 4.3, calcium: 54, magnesium: 68, zinc: 4.7, benefits: ['Supports cholesterol management', 'Promotes gut health', 'Aids satiety'], pairingTips: ['Soluble fiber requires adequate fluid intake', 'Pair with berries for antioxidant synergy'] },
      { id: 29, name: 'Whole Wheat Bread', emoji: 'üçû', category: 'grains', tags: ['gut', 'energy', 'brain'], serving: '1 slice (43g)', calories: 81, protein: 4, carbs: 14, fat: 1.1, fiber: 1.9, sugar: 1.4, vitaminC: 0, potassium: 81, vitaminA: 0, iron: 1.6, calcium: 25, magnesium: 24, zinc: 0.7, benefits: ['Supports digestive health', 'Stabilizes energy', 'Provides nutrient density'], pairingTips: ['Pair with protein and fat for balanced meals', 'Choose varieties with minimal additives'] },
      { id: 30, name: 'Greek Yogurt', emoji: 'ü•Ñ', category: 'dairy', tags: ['gut', 'bone', 'energy'], serving: '1 cup (245g)', calories: 100, protein: 17, carbs: 6, fat: 0.7, fiber: 0, sugar: 4, vitaminC: 0, potassium: 240, vitaminA: 21, iron: 0.1, calcium: 300, magnesium: 20, zinc: 0.6, benefits: ['Supports gut microbiome', 'Builds muscle', 'Strengthens bones'], pairingTips: ['Plain yogurt without added sugar preferred', 'Combine with fiber for prebiotic + probiotic synergy'] },
      { id: 31, name: 'Milk (2%)', emoji: 'ü•õ', category: 'dairy', tags: ['bone', 'energy', 'hormones'], serving: '1 cup (244ml)', calories: 122, protein: 8.1, carbs: 12, fat: 4.8, fiber: 0, sugar: 12, vitaminC: 0, potassium: 342, vitaminA: 45, iron: 0.1, calcium: 293, magnesium: 27, zinc: 0.9, benefits: ['Supports bone health', 'Aids muscle recovery', 'Strengthens teeth'], pairingTips: ['Vitamin D enhances calcium absorption', 'Consume with meals for better absorption'] },
      { id: 32, name: 'Cheddar Cheese', emoji: 'üßÄ', category: 'dairy', tags: ['bone', 'energy', 'brain'], serving: '1 oz (28g)', calories: 113, protein: 7, carbs: 0.4, fat: 9.3, fiber: 0, sugar: 0.1, vitaminC: 0, potassium: 28, vitaminA: 75, iron: 0.7, calcium: 202, magnesium: 8, zinc: 2.8, benefits: ['Supports bone health', 'Strengthens immune function', 'Aids enzyme activity'], pairingTips: ['Aged cheese has lower lactose', 'Use smaller amounts for flavor'] },
      { id: 33, name: 'Almonds', emoji: 'ü•ú', category: 'nuts', tags: ['heart', 'energy', 'skin'], serving: '1 oz (28g)', calories: 164, protein: 6, carbs: 6, fat: 14, fiber: 3.5, sugar: 1.2, vitaminC: 0, potassium: 208, vitaminA: 0, iron: 1.3, calcium: 76, magnesium: 76, zinc: 0.9, benefits: ['Supports heart health', 'Promotes vascular function', 'Stabilizes blood sugar'], pairingTips: ['Raw or lightly roasted preserves nutrients', 'Soak overnight to reduce phytic acid'] },
      { id: 34, name: 'Walnuts', emoji: 'üå∞', category: 'nuts', tags: ['brain', 'heart', 'energy'], serving: '1 oz (28g)', calories: 185, protein: 4.3, carbs: 3.9, fat: 18, fiber: 1.9, sugar: 0.7, vitaminC: 0, potassium: 125, vitaminA: 1, iron: 0.8, calcium: 28, magnesium: 45, zinc: 0.9, benefits: ['Supports brain health', 'Promotes heart function', 'Reduces inflammation'], pairingTips: ['Store in cool, dark place as omega-3s are fragile', 'Consume with other foods to maximize benefits'] },
      { id: 35, name: 'Peanut Butter', emoji: 'ü•ú', category: 'nuts', tags: ['energy', 'brain', 'hormones'], serving: '2 tbsp (32g)', calories: 188, protein: 8, carbs: 6, fat: 16, fiber: 1.9, sugar: 3, vitaminC: 0, potassium: 189, vitaminA: 0, iron: 0.6, calcium: 18, magnesium: 51, zinc: 0.9, benefits: ['Supports muscle building', 'Promotes satiety', 'Provides heart-healthy fats'], pairingTips: ['Natural peanut butter without added oils preferred', 'Pair with whole grains for complete protein'] },
      { id: 36, name: 'Chia Seeds', emoji: 'ü´ò', category: 'nuts', tags: ['gut', 'heart', 'bone'], serving: '1 oz (28g)', calories: 138, protein: 4.7, carbs: 12, fat: 8.7, fiber: 9.8, sugar: 0, vitaminC: 0, potassium: 115, vitaminA: 1, iron: 1.6, calcium: 179, magnesium: 95, zinc: 1.3, benefits: ['Supports heart and digestive health', 'Promotes satiety', 'Aids blood sugar control'], pairingTips: ['Soak in liquid to absorb and aid digestion', 'Add to smoothies, puddings, or oatmeal'] },
      { id: 37, name: 'Flax Seeds', emoji: 'üå±', category: 'nuts', tags: ['gut', 'hormones', 'heart'], serving: '1 tbsp (10g)', calories: 55, protein: 1.9, carbs: 3, fat: 4.3, fiber: 2.8, sugar: 0.2, vitaminC: 0, potassium: 84, vitaminA: 0, iron: 0.6, calcium: 26, magnesium: 44, zinc: 0.4, benefits: ['Supports heart and gut health', 'Aids hormone balance', 'Promotes regular digestion'], pairingTips: ['Ground flax has better bioavailability', 'Store ground flax in refrigerator'] },
      { id: 38, name: 'Turkey Breast', emoji: 'ü¶É', category: 'proteins', tags: ['energy', 'brain', 'hormones'], serving: '100g cooked', calories: 135, protein: 29, carbs: 0, fat: 1, fiber: 0, sugar: 0, vitaminC: 0, potassium: 300, vitaminA: 0, iron: 1.8, calcium: 25, magnesium: 26, zinc: 2.5, benefits: ['Boosts energy production', 'Supports muscle building', 'Aids thyroid health'], pairingTips: ['Tryptophan converts to serotonin with carbs', 'Pair with whole grains for best benefit'] },
      { id: 39, name: 'Tuna', emoji: 'üê†', category: 'proteins', tags: ['brain', 'heart', 'energy'], serving: '100g canned', calories: 132, protein: 23, carbs: 0, fat: 4.6, fiber: 0, sugar: 0, vitaminC: 0, potassium: 201, vitaminA: 8, iron: 1.3, calcium: 17, magnesium: 27, zinc: 0.8, benefits: ['Supports brain and heart health', 'Aids cognitive function', 'Supports thyroid health'], pairingTips: ['Choose water-packed varieties to reduce sodium', 'Use bone-in canned tuna for extra calcium'] },
      { id: 40, name: 'Mozzarella', emoji: 'üßÄ', category: 'dairy', tags: ['bone', 'energy', 'skin'], serving: '1 oz (28g)', calories: 85, protein: 6.3, carbs: 0.6, fat: 6.3, fiber: 0, sugar: 0.3, vitaminC: 0, potassium: 23, vitaminA: 48, iron: 0.2, calcium: 505, magnesium: 6, zinc: 0.7, benefits: ['Supports bone health', 'Aids protein synthesis', 'Strengthens teeth'], pairingTips: ['Fresh mozzarella differs from aged varieties', 'Pair with tomato and basil for synergy'] },
      { id: 41, name: 'Hemp Seeds', emoji: 'üåø', category: 'nuts', tags: ['hormones', 'energy', 'brain'], serving: '3 tbsp (30g)', calories: 161, protein: 9.2, carbs: 2.6, fat: 12.3, fiber: 1.2, sugar: 0, vitaminC: 0, potassium: 529, vitaminA: 0, iron: 4.7, calcium: 119, magnesium: 180, zinc: 2.4, benefits: ['Complete amino acid profile', 'Supports hormone balance', 'Provides sustained energy'], pairingTips: ['Add to smoothies or salads', 'Contains all essential amino acids'] },
      { id: 42, name: 'Pumpkin Seeds', emoji: 'üéÉ', category: 'nuts', tags: ['energy', 'bone', 'skin'], serving: '1 oz (28g)', calories: 163, protein: 8.5, carbs: 3, fat: 15.6, fiber: 1.7, sugar: 0.5, vitaminC: 0.5, potassium: 265, vitaminA: 0, iron: 2.3, calcium: 9, magnesium: 156, zinc: 4.2, benefits: ['Boosts immune function', 'Supports energy levels', 'Aids prostate health'], pairingTips: ['Add to salads or eat as snack', 'Pair with vitamin C foods for better absorption'] },
      { id: 43, name: 'Sunflower Seeds', emoji: 'üåª', category: 'nuts', tags: ['heart', 'energy', 'skin'], serving: '1 oz (28g)', calories: 165, protein: 5.5, carbs: 6.5, fat: 14.1, fiber: 2.4, sugar: 2.6, vitaminC: 1.5, potassium: 205, vitaminA: 2, iron: 1.5, calcium: 50, magnesium: 91, zinc: 1.7, benefits: ['Supports heart health', 'Provides vitamin E antioxidants', 'Aids skin health'], pairingTips: ['Add to salads or smoothies', 'Raw or lightly roasted'] },
      { id: 44, name: 'Coconut Oil', emoji: 'ü••', category: 'oils', tags: ['energy', 'brain', 'heart'], serving: '1 tbsp (14g)', calories: 120, protein: 0, carbs: 0, fat: 14, fiber: 0, sugar: 0, vitaminC: 0, potassium: 0, vitaminA: 0, iron: 0, calcium: 0, magnesium: 0, zinc: 0, benefits: ['Provides quick energy', 'Supports cognitive function', 'Anti-inflammatory properties'], pairingTips: ['Use for cooking at moderate heat', 'Add to smoothies for sustained energy'] },
      { id: 45, name: 'Olive Oil', emoji: 'ü´í', category: 'oils', tags: ['heart', 'brain', 'skin'], serving: '1 tbsp (14g)', calories: 120, protein: 0, carbs: 0, fat: 14, fiber: 0, sugar: 0, vitaminC: 0, potassium: 0, vitaminA: 0, iron: 0, calcium: 0, magnesium: 0, zinc: 0, benefits: ['Supports cardiovascular health', 'Reduces inflammation', 'Aids cholesterol management'], pairingTips: ['Use extra virgin for best benefits', 'Add after cooking to preserve nutrients'] },
      { id: 46, name: 'Ginger Root', emoji: 'ü´ö', category: 'vegetables', tags: ['gut', 'energy', 'brain'], serving: '1 tbsp (5g)', calories: 5, protein: 0.1, carbs: 1.1, fat: 0, fiber: 0.2, sugar: 0, vitaminC: 0.4, potassium: 30, vitaminA: 0, iron: 0.1, calcium: 2, magnesium: 4, zinc: 0.1, benefits: ['Aids digestion naturally', 'Reduces inflammation', 'Supports nausea relief'], pairingTips: ['Fresh ginger is most potent', 'Add to teas, smoothies, or stir-fries'] },
      { id: 47, name: 'Turmeric', emoji: 'üßÇ', category: 'vegetables', tags: ['heart', 'brain', 'energy'], serving: '1 tsp (3g)', calories: 8, protein: 0.3, carbs: 1.4, fat: 0.3, fiber: 0.4, sugar: 0, vitaminC: 1.7, potassium: 60, vitaminA: 0, iron: 3.1, calcium: 15, magnesium: 13, zinc: 0.2, benefits: ['Powerful anti-inflammatory', 'Supports brain health', 'Aids joint comfort'], pairingTips: ['Pair with black pepper for better absorption', 'Add to curries, smoothies, or golden milk'] },
      { id: 48, name: 'Rosemary', emoji: 'üåø', category: 'vegetables', tags: ['brain', 'energy', 'heart'], serving: '1 tbsp (4g)', calories: 4, protein: 0.1, carbs: 0.6, fat: 0.3, fiber: 0.4, sugar: 0, vitaminC: 0.8, potassium: 20, vitaminA: 3, iron: 0.1, calcium: 20, magnesium: 3, zinc: 0.1, benefits: ['Supports memory and focus', 'Aids circulation', 'Anti-inflammatory properties'], pairingTips: ['Add to herbs de Provence blends', 'Infuse in oils or teas'] },
      { id: 49, name: 'Dark Chocolate (85%)', emoji: 'üç´', category: 'nuts', tags: ['heart', 'brain', 'skin'], serving: '1 oz (28g)', calories: 170, protein: 4, carbs: 13, fat: 12, fiber: 3.1, sugar: 1, vitaminC: 0, potassium: 175, vitaminA: 0, iron: 3.3, calcium: 12, magnesium: 65, zinc: 1.6, benefits: ['Supports heart health', 'Improves mood', 'Aids cognitive function'], pairingTips: ['Choose 85%+ cacao for health benefits', 'Pair with berries for extra antioxidants'] },
      { id: 50, name: 'Kombucha', emoji: 'üç∂', category: 'dairy', tags: ['gut', 'energy', 'hormones'], serving: '8 fl oz (240ml)', calories: 30, protein: 0.5, carbs: 3, fat: 0, fiber: 0, sugar: 2, vitaminC: 0, potassium: 40, vitaminA: 0, iron: 0.3, calcium: 15, magnesium: 0, zinc: 0.1, benefits: ['Supports gut microbiome', 'Aids digestion', 'Boosts immune function'], pairingTips: ['Drink in moderation due to sugar', 'Choose varieties with minimal added sugar'] },
    ];

    let filteredFoods = [...foodDatabase];
    let nextFoodId = 51;

    // Nutrient mapping for high-in filter
    const nutrientMap = {
      'fiber': food => food.fiber >= 3,
      'protein': food => food.protein >= 10,
      'calcium': food => food.calcium >= 50,
      'iron': food => food.iron >= 1.5,
      'vitaminC': food => food.vitaminC >= 30,
      'omega3': true,
      'antioxidants': true,
      'potassium': food => food.potassium >= 300
    };

    // Page switching functions
    function switchToExplorer() {
      document.getElementById('explorer-page').classList.remove('hidden');
      document.getElementById('goals-page').classList.add('hidden');
      applyTheme();
    }

    function switchToGoals() {
      document.getElementById('explorer-page').classList.add('hidden');
      document.getElementById('goals-page').classList.remove('hidden');
      applyTheme();
    }

    function selectGoal(goalKey) {
      const goal = goalsData[goalKey];
      const theme = getTheme();
      document.getElementById('goals-selection').classList.add('hidden');
      document.getElementById('goal-results').classList.remove('hidden');

      // Populate goal info
      document.getElementById('result-emoji').textContent = goal.emoji;
      document.getElementById('result-title').textContent = goal.title;
      document.getElementById('result-description').textContent = goal.description;

      // Render nutrients
      const nutrientsList = document.getElementById('nutrients-list');
      nutrientsList.innerHTML = goal.nutrients.map((nutrient, idx) => `
        <div class="p-4 rounded-lg animate-fade-in" style="background: ${theme.surface}; border: 2px solid ${theme.border}; animation-delay: ${idx * 30}ms;">
          <p style="color: ${theme.textSecondary}; font-size: 13px; line-height: 1.4;">${nutrient}</p>
        </div>
      `).join('');

      // Get and render recommended foods
      const recommendedFoods = foodDatabase.filter(food => 
        goal.tags.some(tag => food.tags.includes(tag))
      ).slice(0, 8);

      const foodsList = document.getElementById('recommended-foods');
      foodsList.innerHTML = recommendedFoods.map((food, idx) => {
        // Pick one reason based on the goal
        let reason = '';
        if (goalKey === 'low-energy') {
          reason = food.iron > 1 ? `iron for energy production` : 
                   food.carbs > 15 ? `complex carbs for sustained energy` : 
                   `protein for stable blood sugar`;
        } else if (goalKey === 'bloating') {
          reason = food.fiber > 2 ? `fiber to feed beneficial gut bacteria` : 
                   `digestive support`;
        } else if (goalKey === 'hormone-support') {
          reason = food.zinc > 1 ? `zinc for hormone balance` : 
                   food.magnesium > 30 ? `magnesium for endocrine health` : 
                   `hormone-supporting compounds`;
        } else if (goalKey === 'brain-fog') {
          reason = food.tags.includes('brain') ? `omega-3s and antioxidants for cognitive clarity` : 
                   `brain-boosting nutrients`;
        } else if (goalKey === 'bone-support') {
          reason = food.calcium > 50 ? `calcium for bone density` : 
                   `magnesium and minerals for bone health`;
        } else if (goalKey === 'heart-support') {
          reason = food.potassium > 300 ? `potassium for heart function` : 
                   food.tags.includes('heart') ? `heart-healthy compounds` : 
                   `cardiovascular support`;
        }
        
        return `
          <div class="p-5 rounded-lg animate-fade-in" style="background: ${theme.surface}; border: 2px solid ${theme.border}; animation-delay: ${idx * 30}ms;">
            <div class="flex items-start gap-4">
              <span class="text-4xl flex-shrink-0">${food.emoji}</span>
              <div class="flex-1">
                <h4 class="font-bold text-lg mb-1" style="color: ${theme.text};">${food.name}</h4>
                <p class="text-sm mb-2" style="color: ${theme.textSecondary};">This supports ${goal.title.toLowerCase()} because it contains ${reason}.</p>
                <p class="text-xs" style="color: #9ca583;">${food.serving}</p>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function backToGoalSelection() {
      document.getElementById('goals-selection').classList.remove('hidden');
      document.getElementById('goal-results').classList.add('hidden');
    }

    function renderFoodCard(food, index) {
      const delay = index * 30;
      const theme = getTheme();
      return `
        <div class="rounded-xl p-5 cursor-pointer transition-all duration-300 hover:shadow-lg hover:scale-[1.02] animate-fade-in" 
             style="background: ${theme.surface}; border: 1px solid ${theme.border}; animation-delay: ${delay}ms;"
             onclick="showFoodDetail(${food.id})">
          <div class="flex items-start justify-between mb-3">
            <div class="flex items-center gap-3">
              <span class="text-4xl">${food.emoji}</span>
              <div>
                <h3 class="font-bold text-lg" style="color: ${theme.text};">${food.name}</h3>
                <p class="text-xs capitalize" style="color: ${theme.textSecondary};">${food.category}</p>
              </div>
            </div>
            <div class="text-right">
              <span class="text-xl font-bold" style="color: #9ca583;">${food.calories}</span>
              <p class="text-xs" style="color: ${theme.textSecondary};">kcal</p>
            </div>
          </div>
          <p class="text-xs mb-3" style="color: ${theme.textSecondary};">Per ${food.serving}</p>
          <div class="grid grid-cols-4 gap-2">
            <div class="text-center p-2 rounded-lg" style="background: ${theme.wrapper};">
              <p class="font-bold text-sm" style="color: #c4614e;">${food.protein}g</p>
              <p class="text-xs" style="color: ${theme.textSecondary};">Protein</p>
            </div>
            <div class="text-center p-2 rounded-lg" style="background: ${theme.wrapper};">
              <p class="font-bold text-sm" style="color: #5b8c6f;">${food.carbs}g</p>
              <p class="text-xs" style="color: ${theme.textSecondary};">Carbs</p>
            </div>
            <div class="text-center p-2 rounded-lg" style="background: ${theme.wrapper};">
              <p class="font-bold text-sm" style="color: #d4a66b;">${food.fat}g</p>
              <p class="text-xs" style="color: ${theme.textSecondary};">Fat</p>
            </div>
            <div class="text-center p-2 rounded-lg" style="background: ${theme.wrapper};">
              <p class="font-bold text-sm" style="color: #e67e50;">${food.sugar}g</p>
              <p class="text-xs" style="color: ${theme.textSecondary};">Sugar</p>
            </div>
          </div>
          <!-- Tag Pills -->
          <div class="flex flex-wrap gap-1 mt-4">
            ${food.tags.slice(0, 2).map(tag => `
              <span class="inline-block px-2 py-1 rounded-full text-xs font-semibold" style="background: ${theme.wrapper}; color: ${theme.textSecondary};">
                ${goalIcons[tag]} ${goalLabels[tag]}
              </span>
            `).join('')}
            ${food.tags.length > 2 ? `<span class="inline-block px-2 py-1 rounded-full text-xs font-semibold" style="background: ${theme.wrapper}; color: ${theme.textSecondary};">+${food.tags.length - 2}</span>` : ''}
          </div>
        </div>
      `;
    }

    function renderFoodGrid() {
      const grid = document.getElementById('food-grid');
      const resultsCount = document.getElementById('results-count');
      const theme = getTheme();
      
      if (filteredFoods.length === 0) {
        grid.innerHTML = `
          <div class="col-span-full text-center py-16">
            <span class="text-6xl mb-4 block">üîç</span>
            <p class="text-xl font-semibold" style="color: ${theme.text};">No foods found</p>
            <p style="color: ${theme.textSecondary};">Try adjusting your search or filters</p>
          </div>
        `;
        resultsCount.textContent = '0 results';
      } else {
        grid.innerHTML = filteredFoods.map((food, index) => renderFoodCard(food, index)).join('');
        resultsCount.textContent = `${filteredFoods.length} food${filteredFoods.length !== 1 ? 's' : ''} found`;
      }
      resultsCount.style.color = theme.textSecondary;
    }

    function showFoodDetail(foodId) {
      const food = foodDatabase.find(f => f.id === foodId);
      if (!food) return;

      const modal = document.getElementById('detail-modal');
      const content = document.getElementById('modal-content');
      const theme = getTheme();
      
      content.innerHTML = `
        <div class="p-8">
          <div class="flex items-start justify-between mb-6">
            <div class="flex items-center gap-4">
              <span class="text-6xl">${food.emoji}</span>
              <div>
                <h2 class="text-3xl font-bold" style="color: ${theme.text};">${food.name}</h2>
                <p style="color: ${theme.textSecondary};">${food.category}</p>
                <p class="text-sm mt-1" style="color: ${theme.textSecondary};">Serving: ${food.serving}</p>
              </div>
            </div>
            <button onclick="closeModal()" class="p-2 rounded-lg transition-colors hover:opacity-80" style="background: ${theme.wrapper};">
              <svg class="w-6 h-6" fill="none" stroke="${theme.text}" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>

          <!-- Tags Pills -->
          ${food.tags && food.tags.length > 0 ? `
          <div class="mb-6 flex flex-wrap gap-2">
            ${food.tags.map(tag => `
              <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold" style="background: ${theme.wrapper}; color: ${theme.textSecondary};">
                ${goalIcons[tag]} ${goalLabels[tag]}
              </span>
            `).join('')}
          </div>
          ` : ''}

          <!-- Calories Display -->
          <div class="text-center p-6 rounded-xl mb-6" style="background: ${theme.wrapper}; border-left: 4px solid #9ca583;">
            <span class="text-5xl font-bold" style="color: #9ca583;">${food.calories}</span>
            <p class="text-base mt-2" style="color: ${theme.text};">Calories per serving</p>
          </div>

          <!-- Macronutrient Breakdown -->
          <h3 class="font-bold text-lg mb-4" style="color: ${theme.text};">Macronutrient Breakdown</h3>
          <div class="grid grid-cols-4 gap-3 mb-8">
            <div class="text-center p-4 rounded-lg" style="background: ${theme.surface}; border: 2px solid ${theme.border};">
              <p class="font-bold text-sm" style="color: #c4614e;">${food.protein}g</p>
              <p class="text-xs mt-1" style="color: ${theme.textSecondary};">Protein</p>
            </div>
            <div class="text-center p-4 rounded-lg" style="background: ${theme.surface}; border: 2px solid ${theme.border};">
              <p class="font-bold text-sm" style="color: #5b8c6f;">${food.carbs}g</p>
              <p class="text-xs mt-1" style="color: ${theme.textSecondary};">Carbs</p>
            </div>
            <div class="text-center p-4 rounded-lg" style="background: ${theme.surface}; border: 2px solid ${theme.border};">
              <p class="font-bold text-sm" style="color: #d4a66b;">${food.fat}g</p>
              <p class="text-xs mt-1" style="color: ${theme.textSecondary};">Fat</p>
            </div>
            <div class="text-center p-4 rounded-lg" style="background: ${theme.surface}; border: 2px solid ${theme.border};">
              <p class="font-bold text-sm" style="color: #e67e50;">${food.sugar}g</p>
              <p class="text-xs mt-1" style="color: ${theme.textSecondary};">Sugar (g)</p>
            </div>
          </div>

          <!-- Top Key Nutrients -->
          <h3 class="font-bold text-lg mb-4" style="color: ${theme.text};">Top Key Nutrients</h3>
          <div class="space-y-3 mb-8 p-5 rounded-lg" style="background: ${theme.surface}; border: 2px solid ${theme.border};">
            <div class="flex justify-between items-center p-3 rounded-lg border-l-4" style="background: ${theme.surface}; border-color: #c4614e;">
              <span style="color: ${theme.text};"><strong>Protein:</strong> ${food.protein}g</span>
              <span class="text-sm font-semibold" style="color: #c4614e; background: #ffe8e2; padding: 4px 8px; border-radius: 4px;">${Math.round((food.protein / 50) * 100)}% DV</span>
            </div>
            <div class="flex justify-between items-center p-3 rounded-lg border-l-4" style="background: ${theme.surface}; border-color: #5b8c6f;">
              <span style="color: ${theme.text};"><strong>Fiber:</strong> ${food.fiber}g</span>
              <span class="text-sm font-semibold" style="color: #5b8c6f; background: #e8f1ec; padding: 4px 8px; border-radius: 4px;">${Math.round((food.fiber / 25) * 100)}% DV</span>
            </div>
            <div class="flex justify-between items-center p-3 rounded-lg border-l-4" style="background: ${theme.surface}; border-color: #d4a66b;">
              <span style="color: ${theme.text};"><strong>Calcium:</strong> ${food.calcium}mg</span>
              <span class="text-sm font-semibold" style="color: #d4a66b; background: #fef3e2; padding: 4px 8px; border-radius: 4px;">${Math.round((food.calcium / 1300) * 100)}% DV</span>
            </div>
            <div class="flex justify-between items-center p-3 rounded-lg border-l-4" style="background: ${theme.surface}; border-color: #9ca583;">
              <span style="color: ${theme.text};"><strong>Iron:</strong> ${food.iron}mg</span>
              <span class="text-sm font-semibold" style="color: #9ca583; background: #e8f0e5; padding: 4px 8px; border-radius: 4px;">${Math.round((food.iron / 18) * 100)}% DV</span>
            </div>
            <div class="flex justify-between items-center p-3 rounded-lg border-l-4" style="background: ${theme.surface}; border-color: #8b7355;">
              <span style="color: ${theme.text};"><strong>Vitamin C:</strong> ${food.vitaminC}mg</span>
              <span class="text-sm font-semibold" style="color: #8b7355; background: #f3e8e2; padding: 4px 8px; border-radius: 4px;">${Math.round((food.vitaminC / 90) * 100)}% DV</span>
            </div>
          </div>

          <!-- Macro Progress Bars -->
          <h3 class="font-bold text-lg mb-4" style="color: ${theme.text};">Macro Composition</h3>
          <div class="space-y-3 mb-8">
            <div>
              <div class="flex justify-between mb-1">
                <span style="color: ${theme.text};">Carbohydrates</span>
                <span class="font-bold" style="color: #5b8c6f;">${food.carbs}g</span>
              </div>
              <div class="h-2 rounded-full overflow-hidden" style="background: ${theme.border};">
                <div class="h-full" style="width: ${Math.min((food.carbs / 300) * 100, 100)}%; background: linear-gradient(90deg, #5b8c6f, #7aa587);"></div>
              </div>
            </div>
            <div>
              <div class="flex justify-between mb-1">
                <span style="color: ${theme.text};">Fat</span>
                <span class="font-bold" style="color: #d4a66b;">${food.fat}g</span>
              </div>
              <div class="h-2 rounded-full overflow-hidden" style="background: ${theme.border};">
                <div class="h-full" style="width: ${Math.min((food.fat / 78) * 100, 100)}%; background: linear-gradient(90deg, #d4a66b, #e8b87a);"></div>
              </div>
            </div>
          </div>

          <!-- Benefits -->
          <h3 class="font-bold text-lg mb-4" style="color: ${theme.text};">Health Benefits</h3>
          <div class="space-y-2 mb-8">
            ${food.benefits.map(benefit => `
              <div class="flex items-start gap-3 p-3 rounded-lg" style="background: ${theme.wrapper};">
                <span style="color: #9ca583; font-size: 18px;">‚úì</span>
                <span style="color: ${theme.text};">${benefit}</span>
              </div>
            `).join('')}
          </div>

          <!-- Best Pairing Tips -->
          <h3 class="font-bold text-lg mb-4" style="color: ${theme.text};">Best Pairing Tips</h3>
          <div class="space-y-2">
            ${food.pairingTips.map(tip => `
              <div class="flex items-start gap-3 p-3 rounded-lg" style="background: ${theme.wrapper}; border-left: 3px solid #9ca583;">
                <span style="color: #9ca583; font-size: 14px;">‚Üí</span>
                <span style="color: ${theme.text}; font-size: 14px;">${tip}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `;

      modal.classList.remove('hidden');
      modal.classList.add('flex');
      const modalWrapper = modal.querySelector('div:not(#modal-content)');
      if (modalWrapper) modalWrapper.style.background = theme.modalBg;
    }

    function closeModal() {
      const modal = document.getElementById('detail-modal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }

    function openAddFoodModal() {
      const modal = document.getElementById('add-food-modal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      document.getElementById('add-food-form').reset();
      document.getElementById('form-error').style.display = 'none';
      applyTheme();
    }

    function closeAddFoodModal() {
      const modal = document.getElementById('add-food-modal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }

    function submitAddFood(event) {
      event.preventDefault();

      // Get form values
      const name = document.getElementById('food-name').value.trim();
      const emoji = document.getElementById('food-emoji').value.trim() || 'üçΩÔ∏è';
      const category = document.getElementById('food-category').value.trim();
      const serving = document.getElementById('food-serving').value.trim();
      const calories = parseFloat(document.getElementById('food-calories').value) || 0;
      const protein = parseFloat(document.getElementById('food-protein').value) || 0;
      const carbs = parseFloat(document.getElementById('food-carbs').value) || 0;
      const fat = parseFloat(document.getElementById('food-fat').value) || 0;
      const fiber = parseFloat(document.getElementById('food-fiber').value) || 0;
      const sugar = parseFloat(document.getElementById('food-sugar').value) || 0;
      const vitaminC = parseFloat(document.getElementById('food-vitaminC').value) || 0;
      const potassium = parseFloat(document.getElementById('food-potassium').value) || 0;
      const vitaminA = parseFloat(document.getElementById('food-vitaminA').value) || 0;
      const iron = parseFloat(document.getElementById('food-iron').value) || 0;
      const calcium = parseFloat(document.getElementById('food-calcium').value) || 0;
      const magnesium = parseFloat(document.getElementById('food-magnesium').value) || 0;
      const zinc = parseFloat(document.getElementById('food-zinc').value) || 0;
      
      // Parse comma-separated lists
      const tags = document.getElementById('food-tags').value.split(',').map(t => t.trim().toLowerCase()).filter(t => t && goalLabels[t]);
      const benefits = document.getElementById('food-benefits').value.split(',').map(b => b.trim()).filter(b => b);
      const pairingTips = document.getElementById('food-pairingTips').value.split(',').map(p => p.trim()).filter(p => p);

      // Validate required fields
      const errorDiv = document.getElementById('form-error');
      const errorMsg = document.getElementById('error-message');

      if (!name) {
        errorMsg.textContent = '‚ùå Food name is required';
        errorDiv.style.display = 'block';
        return;
      }
      if (!category) {
        errorMsg.textContent = '‚ùå Category is required';
        errorDiv.style.display = 'block';
        return;
      }
      if (!serving) {
        errorMsg.textContent = '‚ùå Serving size is required';
        errorDiv.style.display = 'block';
        return;
      }
      if (calories === 0 || isNaN(calories)) {
        errorMsg.textContent = '‚ùå Calories must be a valid number';
        errorDiv.style.display = 'block';
        return;
      }

      // Create food object
      const newFood = {
        id: nextFoodId++,
        name,
        emoji,
        category,
        tags: tags.length > 0 ? tags : ['energy'],
        serving,
        calories,
        protein,
        carbs,
        fat,
        fiber,
        sugar,
        vitaminC,
        potassium,
        vitaminA,
        iron,
        calcium,
        magnesium,
        zinc,
        benefits: benefits.length > 0 ? benefits : ['Nutritious addition to your diet'],
        pairingTips: pairingTips.length > 0 ? pairingTips : ['Enjoy as part of a balanced meal']
      };

      // Add to database
      foodDatabase.push(newFood);

      // Reset filters and re-render
      filterFoods();
      closeAddFoodModal();
      
      // Show success message
      const successDiv = document.createElement('div');
      successDiv.className = 'fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-semibold animate-fade-in';
      successDiv.style.background = '#9ca583';
      successDiv.textContent = `‚úì ${name} added successfully!`;
      document.body.appendChild(successDiv);
      setTimeout(() => successDiv.remove(), 3000);
    }

    function filterFoods() {
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      const category = document.getElementById('category-filter').value;
      const goal = document.getElementById('goal-filter').value;
      const nutrient = document.getElementById('nutrient-filter').value;
      const system = document.getElementById('system-filter').value;

      filteredFoods = foodDatabase.filter(food => {
        const matchesSearch = food.name.toLowerCase().includes(searchTerm);
        const matchesCategory = category === 'all' || food.category === category;
        const matchesGoal = goal === 'all' || (food.tags && food.tags.includes(goal));
        const matchesNutrient = nutrient === 'all' || (nutrientMap[nutrient] && nutrientMap[nutrient](food));
        const matchesSystem = system === 'all' || (food.tags && food.tags.includes(system));
        
        return matchesSearch && matchesCategory && matchesGoal && matchesNutrient && matchesSystem;
      });

      renderFoodGrid();
    }

    // Event Listeners
    document.getElementById('search-input').addEventListener('input', filterFoods);
    document.getElementById('category-filter').addEventListener('change', filterFoods);
    document.getElementById('goal-filter').addEventListener('change', filterFoods);
    document.getElementById('nutrient-filter').addEventListener('change', filterFoods);
    document.getElementById('system-filter').addEventListener('change', filterFoods);
    document.getElementById('detail-modal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });
    document.getElementById('add-food-modal').addEventListener('click', function(e) {
      if (e.target === this) closeAddFoodModal();
    });

    // Element SDK Integration - ONLY for editable text (app title/subtitle)
    const defaultConfig = {
      app_title: 'Nutrition Explorer',
      app_subtitle: 'Discover foods that support your wellness'
    };

    async function onConfigChange(config) {
      const appTitle = document.getElementById('app-title');
      const appSubtitle = document.getElementById('app-subtitle');

      appTitle.textContent = config.app_title || defaultConfig.app_title;
      appSubtitle.textContent = config.app_subtitle || defaultConfig.app_subtitle;
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['app_subtitle', config.app_subtitle || defaultConfig.app_subtitle]
      ]);
    }

    // Initialize
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    // Apply initial theme and render
    applyTheme();
    renderFoodGrid();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd17e91a3433371',t:'MTc3MDk1NjAxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
